{% extends 'blog/base.html' %}
{% load static %}
{% block header %}
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.css' rel='stylesheet'/>
{% endblock %}
{% block banner %}
    <section class="banner">
        <div class="banner-inner">
            <img src="{% static 'pictures/top_background.jpg' %}">
        </div>
        <h2>
            BLOG
        </h2>
    </section>
{% endblock %}
{% block three_columns %}
<section class="one-third" id="post-1-main">
    <div class="post-container">
        <a href="{{ latest_post.get_absolute_url }}"><img src="{{ latest_post.main_image.picture.url }}">
        <div class="post-title">
            {{ latest_post.title }}<br>
            <div id="post-date">{{ latest_post_date }}</div>
            <div id="post-place">{{ latest_post.title_place }}</div>
        </div>
        </a>
    </div>
</section>
<section class="one-third" id="post-2-main">
    <div class="post-container">
        <a href="{{ second_latest_post.get_absolute_url }}"><img src="{{ second_latest_post.main_image.picture.url }}">
        <div class="post-title">
            {{ second_latest_post.title }}<br>
            <div id="post-date">{{ second_latest_post_date }}</div>
            <div id="post-place">{{ second_latest_post.title_place }}</div>
        </div>
        </a>
    </div>
</section>
<section class="one-third" id="post-3-main">
    <div class="post-container">
        <a href="{{ third_latest_post.get_absolute_url }}"><img src="{{ third_latest_post.main_image.picture.url }}">
        <div class="post-title">
            {{ third_latest_post.title }}<br>
            <div id="post-date">{{ third_latest_post_date }}</div>
            <div id="post-place">{{ third_latest_post.title_place }}</div>
        </div>
        </a>
    </div>
</section>
{% endblock %}

{% block two_columns %}
<section class="inner-wrapper">
    <article id="about-us">
        <a href="{% url 'about_us' %}"><img src="{% static 'pictures/about_us.jpg' %}"></a>
    </article>
    <aside id="about-us">
        <h2><a href="{% url 'about_us' %}">ABOUT US</a></h2>
        <p id="about-us-p">We got addicted to travelling about seven years ago, when Magda moved to Spain for the first time.
            We would travel to see each other at least once a month and then we just couldn’t stop.
            Both of us have a full time job in Barcelona, so we had to become experts in optimising holidays.
            We’re hooked on Fly4free newsletter and try to travel where a good deal takes us.</p>
            <p id="about-us-p">Our trips are about nice places, photography and good food, trying always to compromise between Magda’s love for
            the fresh towels in hotels and Michał’s budgetary concerns :) This blog is meant to be our travel diary, a motivation
            to improve our photography skills and a place to share with those who consider visiting places we’ve seen.
        </p>
    </aside>
</section>
<section class="inner-wrapper-2">
    <article id="travel-challenge">
        <h2><a href="{% url 'map' %}">THE TRAVEL CHALLENGE</a></h2>
        <p id="about-us-p">When people get married, they usually get good wishes. For us, the best wish is to go to places
            we would fall in love with, so we asked our wedding guests to share the most beautiful places they have ever
            seen and we promised to visit every one of them. We’re not sure the guests were entirely serious (or sober;))
            about them but the promise stands, we’re trying to visit them all. Challenge in progress!</p>
        <div id="progressbar">
            <div>21%</div>
        </div>
        <div class="map-legend">
            <span id="legend-visited">&#x25CF;</span> visited&nbsp;&nbsp;
            <span id="legend-planned">&#x25CF;</span> planned&nbsp;&nbsp;
            <span id="legend-visited-other">&#x25CF;</span> other visited&nbsp;&nbsp;
            <span id="legend-next-destination">&#x25CF;</span> next destination&nbsp;&nbsp;
        </div>
    </article>
    <aside>
            <div id='map-index'></div>
                <script>

                mapboxgl.accessToken = 'pk.eyJ1IjoibWljaGFscHVjaGFsYSIsImEiOiJjamxxeWk0ZTYwcWJyM3BwbGVzMWpobjFqIn0.sBxqcK2lDMxn9RvqaBfduw';

                var map = new mapboxgl.Map({
                  container: 'map-index',
                  style: 'mapbox://styles/mapbox/light-v9',
                  center: [0, 20],
                  zoom: 0.5
                });

                // planned
                var geojson_planned = {
                  type: 'FeatureCollection',
                  features: [
                  {% for i in planned_places %}
                    {
                      type: 'Feature',
                      geometry: {
                        type: 'Point',
                        coordinates: [{{ i.coord_h }}, {{ i.coord_v }}]
                      },
                      properties: {
                        title: "<div class='place-title'>{{ i.name }}</div>",
                        description: "<div class='place-post'>{% for post in i.posts.all %}<a href='{{ post.get_absolute_url }}'>{{ post.title }}</a><br/>{% endfor %}</div>"
                      }
                    },
                  {% endfor %}
                ]
                };

                // add markers to map
                geojson_planned.features.forEach(function(marker) {

                // create a HTML element for each feature
                var el = document.createElement('div');
                el.className = 'marker-light-red';

                // visited
                new mapboxgl.Marker(el)
                .setLngLat(marker.geometry.coordinates)
                .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                .setHTML(marker.properties.title + marker.properties.description))
                .addTo(map);
                });

                var geojson_visited = {
                  type: 'FeatureCollection',
                  features: [
                  {% for i in visited_places %}
                    {
                      type: 'Feature',
                      geometry: {
                        type: 'Point',
                        coordinates: [{{ i.coord_h }}, {{ i.coord_v }}]
                      },
                      properties: {
                        title: "<div class='place-title'>{{ i.name }}</div>",
                        description: "<div class='place-post'>{% for post in i.posts.all %}<a href='{{ post.get_absolute_url }}'>{{ post.title }}</a><br/>{% endfor %}</div>"
                      }
                    },
                  {% endfor %}
                ]
                };

                // add markers to map
                geojson_visited.features.forEach(function(marker) {

                // create a HTML element for each feature
                var el = document.createElement('div');
                el.className = 'marker-light-green';

                // planned wedding
                new mapboxgl.Marker(el)
                .setLngLat(marker.geometry.coordinates)
                .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                .setHTML(marker.properties.title + marker.properties.description))
                .addTo(map);
                });

                var geojson_planned_wedding = {
                  type: 'FeatureCollection',
                  features: [
                  {% for i in planned_wedding_places %}
                    {
                      type: 'Feature',
                      geometry: {
                        type: 'Point',
                        coordinates: [{{ i.coord_h }}, {{ i.coord_v }}]
                      },
                      properties: {
                        title: "<div class='place-title'>{{ i.name }}</div>",
                        description: "<div class='place-post'>{% for post in i.posts.all %}<a href='{{ post.get_absolute_url }}'>{{ post.title }}</a><br/>{% endfor %}</div>"
                      }
                    },
                  {% endfor %}
                ]
                };

                // add markers to map
                geojson_planned_wedding.features.forEach(function(marker) {

                // create a HTML element for each feature
                var el = document.createElement('div');
                el.className = 'marker-red';

                // visited_wedding
                new mapboxgl.Marker(el)
                .setLngLat(marker.geometry.coordinates)
                .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                .setHTML(marker.properties.title + marker.properties.description))
                .addTo(map);
                });

                var geojson_visited_wedding = {
                  type: 'FeatureCollection',
                  features: [
                  {% for i in visited_wedding_places %}
                    {
                      type: 'Feature',
                      geometry: {
                        type: 'Point',
                        coordinates: [{{ i.coord_h }}, {{ i.coord_v }}]
                      },
                      properties: {
                        title: "<div class='place-title'>{{ i.name }}</div>",
                        description: "<div class='place-post'>{% for post in i.posts.all %}<a href='{{ post.get_absolute_url }}'>{{ post.title }}</a><br/>{% endfor %}</div>"
                      }
                    },
                  {% endfor %}
                ]
                };

                // add markers to map
                geojson_visited_wedding.features.forEach(function(marker) {

                // create a HTML element for each feature
                var el = document.createElement('div');
                el.className = 'marker-green';

                // make a marker for each feature and add to the map
                new mapboxgl.Marker(el)
                .setLngLat(marker.geometry.coordinates)
                .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                .setHTML(marker.properties.title + marker.properties.description))
                .addTo(map);
                });

                </script>
    </aside>
</section>
{% endblock %}